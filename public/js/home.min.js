let imageCount=0;const idArr=[];$(document).ready(()=>{const a=new Date,b=new Date(a);b.setDate(b.getDate()-1),$(".dateSubhead").text(b.toISOString().slice(0,10));const c=$(".datepicker");$("#roverOptions").on("change",()=>{$("#cameraOptions").empty();let a=$("#roverOptions").val();"Curiosity"===a?($("#cameraOptions").append(`
      <option value="All">All Cameras</option>
      <option value="FHAZ">Front Hazard Avoidance Camera</option>
      <option value="RHAZ">Rear Hazard Avoidance Camera</option>
      <option value="MAST">Mast Camera</option>
      <option value="CHEMCAM">Chemistry and Camera Complex</option>
      <option value="MAHLI">Mars Hand Lens Imager</option>
      <option value="MARDI">Mars Descent Imager</option>
      <option value="NAVCAM">Navigation Camera</option>
      `),c.datepicker("destroy"),c.datepicker({changeYear:!0,dateFormat:"yy-mm-dd",maxDate:b})):"Opportunity"===a?($("#cameraOptions").append(`
      <option value="All">All Cameras</option>
      <option value="FHAZ">Front Hazard Avoidance Camera</option>
      <option value="RHAZ">Rear Hazard Avoidance Camera</option>
      <option value="NAVCAM">Navigation Camera</option>
      <option value="PANCAM">Panoramic Camera</option>
      <option value="MINITES">Miniature Thermal Emission Spectrometer (Mini-TES)</option>
      `),c.datepicker("destroy"),c.datepicker({changeYear:!0,dateFormat:"yy-mm-dd",maxDate:"2018-06-09"})):"Spirit"===a?($("#cameraOptions").append(`
          <option value="All">All Cameras</option>
          <option value="FHAZ">Front Hazard Avoidance Camera</option>
          <option value="RHAZ">Rear Hazard Avoidance Camera</option>
          <option value="NAVCAM">Navigation Camera</option>
          <option value="PANCAM">Panoramic Camera</option>
          <option value="MINITES">Miniature Thermal Emission Spectrometer (Mini-TES)</option>
          `),c.datepicker("destroy"),c.datepicker({changeYear:!0,dateFormat:"yy-mm-dd",maxDate:"2010-03-21"})):void 0}),$("#loadRoverImages").on("click",function(){const a=$("#roverOptions").val(),b=$("#cameraOptions").val(),c=$("#date").val();console.log(a,b,c),null===a||null===b||""===c?alert("Please select a Rover, a Camera and a Date."):($(".imageSection").find("h1").hide(),$(".roverImageRows").empty(),$(".lds-roller").show(),d())});const d=()=>{const a=$("#roverOptions").val(),b=$("#cameraOptions").val(),c=$("#date").val();$.ajax({url:"/images-by-camera",type:"POST",data:{rovers:a,camera:b,date:c},error:function(a){(504===a.status||503===a.status)&&loadImages()}}).then(d=>{$(".lds-roller").hide(),$(".imageHeader").show(),$(".roverSubhead").text(a),$(".cameraSubhead").text(b),$(".dateSubhead").text(c),0===d.photos.length?($("body").addClass("empty-search-background"),$("body").removeClass("background-image")):($("body").removeClass("empty-search-background"),$("body").addClass("background-image"),d.photos.forEach(a=>{idArr.push(`img-${a.id}`),$(".roverImageRows").append(`
          <div class="col">
          <div class="card shadow-sm">
              <img src=${a.img_src}>
              <div class="card-body">
                <h5 class="card-title">${a.rover.name}</h5>
                  <p class="card-text">${a.camera.full_name}</p>
                  <div class="d-flex justify-content-between align-items-center">
                      <div class="btn-group">
                      <button id=img-${a.id} data-col-id=col-${a.id} data-id=${a.id} data-rover-name=${a.rover.name} data-camera-name=${a.camera.name} data-rover-date=${a.earth_date}
                      data-url=${a.img_src} type="button" class="btn btn-outline-danger like-btn"><i class="far fa-heart"></i></button>
                      </div>
                      <small class="text-muted">${a.earth_date}</small>
                  </div> 
              </div>
              <div class='card-footer'>
              <h6>Share to:</h6>
                <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=${a.img_src}"><i class="fab fa-facebook fa-2x"></i></a>
                <a target="_blank" href="https://twitter.com/share?url=${a.img_src}"><i class="fab fa-twitter fa-2x"></i></a>
              </div>     
          </div>
        </div>`)}),$(".like-btn").on("click",function(){let a=$(this).attr("id"),b=$(this).attr("data-id"),c=$(this).attr("data-col-id"),d=$(this).attr("data-url"),e=$(this).attr("data-rover-name"),f=$(this).attr("data-camera-name"),g=$(this).attr("data-rover-date");$(this).hasClass("liked")?($(this).addClass("unliked"),imageCount--,$(".likedCount").html(`(${imageCount})`),$(".likedImages").find(`#${c}`).remove(),$(this).html("<i class=\"far fa-heart\">"),$(this).removeClass("liked spin"),localStorage.removeItem(a)):(imageCount++,$(".likedCount").html(`(${imageCount})`),$(this).html("<i class=\"fas fa-heart\"></i>"),$(this).removeClass("unliked"),$(this).addClass("liked spin"),$(".likedImages").append(`
              <div id=${c} class="col">
              <div class="card shadow-sm">
                  <img src=${d}>
                  <div class="card-body">
                    <h5 class="card-title">${e}</h5>
                      <p class="card-text">${f}</p>
                      <div class="d-flex justify-content-between align-items-center">
                          <div class="btn-group">
                          <button disabled type="button" class="btn btn-outline-danger like-btn remove liked"><i class="fas fa-heart"></i></button>
                          <button id=${b} data-id=${a} data-col-id=${c} type="button" class="btn btn-success remove">Remove</button>
                          </div>
                          <small class="text-muted">${g}</small>
                      </div> 
                  </div>
                  <div class='card-footer'>
                  <h6>Share to:</h6>
                    <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=${d}"><i class="fab fa-facebook fa-2x"></i></a>
                    <a target="_blank" href="https://twitter.com/share?url=${d}"><i class="fab fa-twitter fa-2x"></i></a>
                  </div>     
              </div>
            </div>`),localStorage.setItem(a,JSON.stringify({id:a,url:d,name:e,cameraName:f,date:g,intId:b,colId:c}))),$(`#${b}`).on("click",function(){imageCount--,$(".likedCount").html(`(${imageCount})`);let a=$(this).attr("data-id"),b=$(this).attr("data-col-id");$(".likedImages").find(`#${b}`).remove(),$(`#${a}`).html("<i class=\"far fa-heart\">").removeClass("liked spin").addClass("unliked"),localStorage.removeItem(a)})}),idArr.forEach(a=>{let b=JSON.parse(localStorage.getItem(a));null!==b&&b.id===a&&($(`#${a}`).css({"background-color":"red",color:"white"}),$(`#${a}`).html("<i class=\"fas fa-heart\"></i>"),$(`#${a}`).addClass("liked"))}))})};for(let[a,b]of Object.entries(localStorage)){let a=JSON.parse(b);imageCount++,console.log(a),$(".likedCount").html(`(${imageCount})`),$(".likedImages, .roverImageRows").append(`
      <div id=${a.colId} class="col">
      <div class="card shadow-sm">
          <img src=${a.url}>
          <div class="card-body">
            <h5 class="card-title">${a.name}</h5>
              <p class="card-text">${a.cameraName}</p>
              <div class="d-flex justify-content-between align-items-center">
                  <div class="btn-group">
                  <button disabled type="button" class="btn btn-outline-danger like-btn liked"><i class="fas fa-heart"></i></button>
                  <button id=${a.intId} data-id=${a.id}  type="button" class="btn btn-success remove">Remove</button>
                  </div>
                 
                  <small class="text-muted">${a.date}</small>
              </div> 
          </div>
          <div class='card-footer'>
          <h6>Share to:</h6>
            <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=${a.url}"><i class="fab fa-facebook fa-2x"></i></a>
            <a target="_blank" href="https://twitter.com/share?url=${a.url}"><i class="fab fa-twitter fa-2x"></i></a>
          </div>     
      </div>
    </div>`),$(`.likedImages #${a.intId}, .roverImageRows #${a.intId}`).on("click",function(){imageCount--,$(".likedCount").html(`(${imageCount})`);let b=$(this).attr("data-id");$(".likedImages, .roverImageRows").find(`#${a.colId}`).remove(),$(`#${b}`).html("<i class=\"far fa-heart\">").removeClass("liked spin").addClass("unliked"),localStorage.removeItem(b)})}});